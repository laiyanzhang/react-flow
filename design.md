# 项目
## 技术设计&任务拆分
### 1.素材库页面（上海or广州）
- 上传文件及附带信息
- 文件分类
- 文件分页
- 单个文件内容展示、删除、下载、预览


### 2.多语言（上海）
- 基础框架搭建
- 各组件静态文本多语言覆盖


### 3.聊天框组件（上海）
- 聊天内容：渲染判断
- 聊天框：输入内容支持
  - 包括@对应员工（群组中需获取对应员工列表）
  - 从素材库选取素材
  - 选取本机文件
- 处理语义识别结果：
  - 识别成功：显示结果
  - 识别失败：提示原因
- 前置提示词与状态：前置提示用户合适输入（设想）
- 接收信息：
  - 接收画布生成结果，渲染到聊天框
  - 接收画布生成中状态，禁止聊天框操作
- 通知信息：
  - 根据语义解析中状态，通知画布禁止操作
  - 根据语义解析结果，通知画布进行节点操作
- 会话：
  - 新建：清空对应的历史记录信息（需额外区分若对话为空时继续新建对话不额外创建新对话）
  - 切换：获取历史记录并将数据分发给聊天框以及画布


### 4.画布组件（广州）
- 新建流程：支持首次对话时创建完整流程
- 部分流程复刻：通过@员工的方式会同时创建输入、员工、输出节点，并且输出节点需自动连上下一个员工（若有）
- 历史记录：画布操作建立历史记录，支持撤销、重做操作
- 节点复制：复制该节点以及节点数据
- 节点删除：删除节点，但同类型节点必须保留最后一个
- 节点修改：修改参数
- 连线调整：连线时判断终点AI员工节点是否已有相同入参
- 员工生成：检测出入口数据，确定生成条件以及生成内容
- 接收信息：
  - 接收聊天框语义解析结果，处理包括生成节点、新建流程、允许操作等
  - 接收聊天框语义解析中状态，禁止画布操作
- 通知信息：
  - 根据节点生成中状态，通知聊天框禁止操作
  - 根据节点生成结果，通知聊天框展示生成结果以及允许操作


### 5.历史记录（广州）
- 两份数据：一份画布数据，一份聊天数据
- 任何一句聊天/画布操作：保存相应历史记录
- 历史记录还原：分发给画布以及聊天框
  - 已生成数据：按照对应数据类型渲染还原
  - 生成中数据：需判断数据状态确定是否要继续轮询/SSE获取生成结果（若为SSE则可直接通过是否仍有数据传来判断）


### 6.AI员工&AI群组
- 针对画布和聊天组件作区分判断的特殊化处理（共同）
- 员工&群组列表的渲染（上海）


### 7.其他处理
- 项目整体框架：包括菜单、头部栏、内容等页面组成构建（上海）
- 基础功能接入：官网登录cookie接入、云上传服务接入等（广州）
- 对接各类AI员工与群组：入参出参处理以及可能涵盖的特殊化处理（共同）




## 各实现细节
### 1. 聊天框语义识别类型
- 根据提供的参数生成流程：新建完整流程的所有节点，根据用户的入参填入创生节点，输出节点暂时为空
- 某个员工重新生成：复制对应员工节点以及输入输出
  - 位置：新的流程在画布上的位置置于旧流程下
  - 输入：按照接口返回的参数填入
  - 输出：需要自动连上对应员工节点的下一个员工节点，输出暂时为空
  - 员工：对应员工永远为最新创建的那个类型员工


### 2.信息传递
- 实现方式：事件监听（第三方库eventemitter3）
- 信息类型约定：互相传递的都是完整的后端结果，由信息接收方解析对应的渲染/操作（接收方可根据自身要求与发送方协商需要的其他信息）
- 聊天框->画布：聊天框获取算法语义识别结果后通过事件总线传递给画布，画布根据语义识别结果绘制对应节点、允许操作等
- 画布->聊天框：画布将生成结果通过事件总线传递给聊天框，聊天框渲染生成结果、允许操作等


## 画布实现细节
### 1.画布节点位置
- 初始节点：各类型节点确定固定宽度，纵坐标相同，对于动态高度节点采用最大高度限制
- @员工新建流程：针对@的员工所在的纵坐标 + 固定间隔得出新建流程中的员工节点，输入输出相关的节点与AI员工节点纵坐标相同，横坐标保持固定间隔
- 复制节点：新增节点与原节点横坐标相同，纵坐标保持固定间隔
- 输出节点：多次点击生成则生成多个输出节点
- 再次生成：会再次生成新的同类型节点并位于原来的同类型节点下面


### 2.画布节点信息
- 需求层面节点类型：创生节点、员工节点、输出节点
- 实现层面节点类型：创生节点需区分参数一类、参数二类、参数三类；员工节点需区分员工一类、员工二类、员工三类等；输出节点需区分员工一类输出、员工二类输出、员工三类输出；用于区分删除时保证某类型节点保留一个不能全删
- 制定AI员工协议标准：根据该协议渲染节点内容
- 预设流程内各节点协议：根据协议渲染流程内各节点内容


### 3.连线
- 调整创生节点的连线时：终点节点是否需要该起点节点作为入参
  - 不需要则不支持连线
  - 需要则判断是否已有相同参数类型节点，若有则需自动断开
- 员工节点点击生成时
  - 入参检测：检测入口数据判断是否支持生成参数内容
  - 出参检测：节点生成时检测出口数据确定生成内容放入节点